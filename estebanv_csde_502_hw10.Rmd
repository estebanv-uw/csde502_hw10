---
title: "CSDE 502 Final Assignment"
author: "[Esteban J. Valencia](mailto:estebanv@uw.edu)"
header-includes:
- \usepackage{float} 
- \floatplacement{figure}{H}
output:
  bookdown::html_document2:
    theme: journal
    number_sections: TRUE
    self_contained: TRUE
    code_folding: hide
    toc: TRUE
    toc_float:
      collapsed: TRUE
      smooth_scroll: TRUE
urlcolor: blue
  pdf_document:
    toc: TRUE
    toc_depth: 2
    number_sections: TRUE
    fig_width: 7
    fig_height: 6
    fig_caption: true
---
```{css, echo=FALSE}
#Step 0.0.1: Setting wide-wise scrolling
pre, code {white-space: pre !important; overflow-x: auto}
```
```{r setup, warning = FALSE, message = FALSE, results = "hide"}
#Step 0.0.2: Specifying chunk options
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, 
                      warning = FALSE, 
                      results = "hide",
                      width = 1000)

#Step 0.0.4: Setting additional options
options(repos = "https://mirror.las.iastate.edu/CRAN/",
        width = 1000)

#Step 0.0.5: Loading requisite packages from library
library(captioner)
library(dplyr)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(ggplot2)

#Step 0.0.6: Setting captions
fig.nums = captioner(prefix = "Figure")
tab.nums = captioner(prefix = "Table")

#Step 0.0.7: Loading data
  ##Specifying data URLs
  url.pop = paste0("https://raw.githubusercontent.com/estebanv-uw/",
                   "csde502_hw10/main/population_data.txt")
  url.dth = paste0("https://raw.githubusercontent.com/estebanv-uw/",
                   "csde502_hw10/main/mortality_data.txt")
  
  ##Reading population data
  df.pop = read.table(file = url.pop, header = TRUE, skip = 2)
  df.dth = read.table(file = url.dth, header = TRUE, skip = 2)
  names(df.pop) %<>% tolower()
  names(df.dth) %<>% tolower()
  
  ##Correcting character vectors
  
    ###Filtering out second entries for year == 1959
    df.pop %<>% filter(year != "1959-")
    
    ###Rendering variable year as integer
    df.pop$year[df.pop$year == "1959+"] = "1959"
    df.pop$year %<>% as.integer()
  
    ###Rendering variable age as integer
    df.pop$age[df.pop$age == "110+"] = "110"
    df.pop$age %<>% as.integer()
  
  
  ##Subsetting data
  df.pop %<>% filter(year != "1959-") %>% select(year, age, total)
  df.dth %<>% filter(year != 1959) %>% select(year, age, total)
  names(df.pop)[3] = "n"
  names(df.dth)[3] = "d"
  
  ##Joining data frame
  df = merge(x = df.pop, y = df.dth, by = c("year", "age"))
  
  ##Summing population totals by year
  df = merge(by = "year",
             x = df,
             y = aggregate(formula = cbind(ntotal = n) ~ year, 
                           data = df, 
                           FUN = sum))
  
  ##Summing deaths totals by year
  df = merge(by = "year",
             x = df,
             y = aggregate(formula = cbind(dtotal = d) ~ year, 
                           data = df, 
                           FUN = sum))
  
  ##Age-specific death rates
  df %<>% mutate(m = d/n)
  
  ##Proportional age distribution
  df %<>% mutate(c = n/ntotal)
  
  ##Calculating crude death rate per 1,000
  df %<>% mutate(cdr = (dtotal/ntotal) * 1000)
  
```

